#!/bin/bash

# declare all allowed directories
declare -a directories=( 'app/code' 'app/etc' app js lib media skin shell var)

echo "# Modman file generated by 'generate-modman' (https://github.com/mhauri/generate-modman)" > modman

function list_directories() {
    find $dir -type d -mindepth $1 -maxdepth $2 | awk '{ print $0 "            " $0 }'
}

function list_not_excluded_files() {
    find $dir -type f -mindepth $1 -maxdepth $2 ! -iname ".*" ! -path "*app/code*" ! -path "*app/etc*" | awk '{ print $0 "            " $0 }'
}

function list_all_files() {
    find $dir -type f -mindepth $1 -maxdepth $2 ! -iname ".*"  | awk '{ print $0 "            " $0 }'
}


for dir in "${directories[@]}"; do
  if [ -d "$dir" ]; then

    if [ $dir == 'app/code' ]; then
        echo "# app/code" >> modman
        list_directories 3 3 >> modman
    fi

    if [ $dir == 'app/etc' ]; then
        echo "# app/etc" >> modman
        list_all_files 2 2 >> modman
    fi

    if [ $dir != 'app/code' ] && [ $dir != 'app/etc' ]; then
        echo "# ${dir}" >> modman
        list_not_excluded_files 0 100 >> modman
    fi


  fi
done
